(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}function l(e,n,r){return n=a(n),function(e,n){if(n&&("object"==t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(n,r||[],a(e).constructor):n.apply(e,r))}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}var u=function(){function t(n){var r;return e(this,t),(r=l(this,t,[n])).renderDeactivatePluginOption=r.renderDeactivatePluginOption.bind(r),r.renderProgressBar=r.renderProgressBar.bind(r),r.renderLog=r.renderLog.bind(r),r.deactivateBylines=r.deactivateBylines.bind(r),r.startMigration=r.startMigration.bind(r),r.clickStart=r.clickStart.bind(r),r.reset=r.reset.bind(r),r.migrateChunkOfData=r.migrateChunkOfData.bind(r),r.getBylinesMigrationInitialData=r.getBylinesMigrationInitialData.bind(r),r.state={totalToMigrate:0,totalMigrated:0,inProgress:!1,chunkSize:r.props.chunkSize,progress:0,log:"",showDeactivateOption:!1,disablingBylines:!1},r}return s(t,React.Component),i(t,[{key:"clickStart",value:function(e){e.preventDefault(),this.startMigration()}},{key:"getBylinesMigrationInitialData",value:function(e){var t=this,n=this;this.setState({log:ppmaBylinesMigration.start_message}),window.setTimeout(function(){jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,async:!1,data:{action:"get_bylines_migration_data",nonce:t.props.nonce},success:function(t){return t.success?(n.setState({totalToMigrate:t.total}),void e()):void n.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+t.error,showDeactivateOption:!1})},error:function(e,t,r){n.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+r+" ["+t+"]",showDeactivateOption:!1})}})},1e3)}},{key:"migrateChunkOfData",value:function(){var e=this;jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"migrate_bylines",nonce:this.props.nonce,chunkSize:this.state.chunkSize},success:function(t){if(t.success){var n=e.state.totalMigrated+e.state.chunkSize;if(n>e.state.totalToMigrate&&(n=e.state.totalToMigrate),e.setState({totalMigrated:n,progress:2+Math.floor(98/e.state.totalToMigrate*n)}),n<e.state.totalToMigrate)e.migrateChunkOfData();else{var r=ppmaBylinesMigration.completed_message;e.setState({progress:100,log:r,showDeactivateOption:!0}),window.setTimeout(function(){e.setState({inProgress:!1})},1e3)}}else e.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+t.error,showDeactivateOption:!1})},error:function(t,n,r){e.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+r+" ["+n+"]",showDeactivateOption:!1})}})}},{key:"startMigration",value:function(){var e=this;this.setState({progress:1,inProgress:!0,log:ppmaBylinesMigration.wait_message,showDeactivateOption:!1}),window.setTimeout(function(){e.getBylinesMigrationInitialData(function(){e.setState({progress:2,log:ppmaBylinesMigration.progress_message}),e.migrateChunkOfData()})},1e3)}},{key:"deactivateBylines",value:function(){var e=this;this.setState({disablingBylines:!0,log:ppmaBylinesMigration.deactivating_message}),jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"deactivate_bylines",nonce:this.props.nonce},success:function(){e.setState({disablingBylines:!1,log:ppmaBylinesMigration.deactivated_message,showDeactivateOption:!1})},error:function(t,n,r){e.setState({disablingBylines:!1,log:ppmaBylinesMigration.error_message+r+" ["+n+"]"})}})}},{key:"renderDeactivatePluginOption",value:function(){var e=ppmaBylinesMigration.deactivate_message,t=!this.state.disablingBylines;return wp.element.createElement(p,{label:e,onClick:this.deactivateBylines,enabled:t})}},{key:"reset",value:function(){this.setState({progress:0,inProgress:!1})}},{key:"renderProgressBar",value:function(){return wp.element.createElement(y,{value:this.state.progress})}},{key:"renderLog",value:function(){return wp.element.createElement(g,{log:this.state.log,show:this.state.showDeactivateOption})}},{key:"render",value:function(){var e=!this.state.inProgress,t=this.state.inProgress?this.renderProgressBar():"",n=""==this.state.log?"":this.renderLog(),r=this.state.showDeactivateOption?this.renderDeactivatePluginOption():"";return wp.element.createElement("div",null,wp.element.createElement(p,{label:ppmaBylinesMigration.copy_message,onClick:this.startMigration,enabled:e}),r,t,n)}}])}(),p=function(){function t(n){return e(this,t),l(this,t,[n])}return s(t,React.Component),i(t,[{key:"render",value:function(){var e=!this.props.enabled;return wp.element.createElement("input",{type:"button",className:"button button-secondary button-danger ppma_maintenance_button",onClick:this.props.onClick,disabled:e,value:this.props.label})}}])}(),g=function(){function t(n){return e(this,t),l(this,t,[n])}return s(t,React.Component),i(t,[{key:"render",value:function(){return wp.element.createElement("div",null,wp.element.createElement("div",{class:"ppma_maintenance_log",readOnly:!0},this.props.log))}}])}(),y=function(){function t(n){return e(this,t),l(this,t,[n])}return s(t,React.Component),i(t,[{key:"renderLabel",value:function(){return wp.element.createElement("div",{className:"p-progressbar-label"},this.props.value," %")}},{key:"render",value:function(){var e=this.renderLabel();return wp.element.createElement("div",{role:"progressbar",id:this.props.id,className:"p-progressbar p-component p-progressbar-determinate",style:this.props.style,"aria-valuemin":"0","aria-valuenow":this.props.value,"aria-valuemax":"100","aria-label":this.props.value},wp.element.createElement("div",{className:"p-progressbar-value p-progressbar-value-animate",style:{width:this.props.value+"%",display:"block"}}),e)}}])}();jQuery(function(){ReactDOM.render(wp.element.createElement(u,{notMigratedPostsId:ppmaBylinesMigration.notMigratedPostsId,nonce:ppmaBylinesMigration.nonce,chunkSize:5}),document.getElementById("publishpress-authors-bylines-migration"))})})();