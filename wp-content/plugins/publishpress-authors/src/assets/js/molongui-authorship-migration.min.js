(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function o(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function r(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function s(t,n,o){return n=a(n),function(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(n,o||[],a(t).constructor):n.apply(t,o))}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(u=function(){return!!t})()}var c=function(){function e(n){var o;return t(this,e),(o=s(this,e,[n])).state={step:"form",log:"",total:0,migrated:0,progress:0,buttonEnabled:!0},o.startMigration=o.startMigration.bind(o),o.deactivateMolongui=o.deactivateMolongui.bind(o),o.migrateMolonguiData=o.migrateMolonguiData.bind(o),o}return l(e,React.Component),r(e,[{key:"componentDidMount",value:function(){this.getMigrationData()}},{key:"getMigrationData",value:function(){var t=this;jQuery.get(ajaxurl,{action:"get_molongui_authorship_migration_data",nonce:this.props.nonce},function(e){t.setState({total:e.total})})}},{key:"startMigration",value:function(){this.setState({step:"migration",log:ppmaMolonguiAuthorshipMigration.start_message,buttonEnabled:!1}),this.migrateMolonguiData()}},{key:"migrateMolonguiData",value:function(){var t=this;jQuery.get(ajaxurl,{action:"migrate_molongui_authorship",nonce:this.props.nonce},function(e){if(e.success){var n=e.total,o=t.state.total-n,r=0<t.state.total?Math.round(o/t.state.total*100):100;t.setState({migrated:o,progress:r,log:"Migrating data... ("+o+"/"+t.state.total+")"}),0<n?setTimeout(function(){t.migrateMolonguiData()},500):t.setState({step:"completed",log:ppmaMolonguiAuthorshipMigration.completed_message,buttonEnabled:!0})}else t.setState({log:ppmaMolonguiAuthorshipMigration.error_message+e.error,buttonEnabled:!0})}).fail(function(e,n,o){t.setState({log:ppmaMolonguiAuthorshipMigration.error_message+o,buttonEnabled:!0})})}},{key:"deactivateMolongui",value:function(){var t=this;this.deactivationInProgress||(this.deactivationInProgress=!0,this.setState({log:ppmaMolonguiAuthorshipMigration.deactivating_message,buttonEnabled:!1}),jQuery.get(ajaxurl,{action:"deactivate_molongui_authorship",nonce:this.props.nonce},function(e){t.deactivationInProgress=!1,e.success?t.setState({log:ppmaMolonguiAuthorshipMigration.deactivated_message,buttonEnabled:!0}):t.setState({log:ppmaMolonguiAuthorshipMigration.error_message+"Failed to deactivate plugin",buttonEnabled:!0})}).fail(function(e,n,o){t.deactivationInProgress=!1,t.setState({log:ppmaMolonguiAuthorshipMigration.error_message+o,buttonEnabled:!0})}))}},{key:"render",value:function(){return"form"===this.state.step?wp.element.createElement("div",null,wp.element.createElement("p",null,"Total items to migrate: ",wp.element.createElement("strong",null,this.state.total)),wp.element.createElement(p,{onClick:this.startMigration,enabled:this.state.buttonEnabled,label:ppmaMolonguiAuthorshipMigration.copy_message})):"migration"===this.state.step?wp.element.createElement("div",null,wp.element.createElement(g,{value:this.state.progress}),wp.element.createElement(m,{log:this.state.log})):"completed"===this.state.step?wp.element.createElement("div",null,wp.element.createElement(m,{log:this.state.log}),wp.element.createElement(p,{onClick:this.deactivateMolongui,enabled:this.state.buttonEnabled,label:ppmaMolonguiAuthorshipMigration.deactivate_message})):null}}])}(),p=function(){function e(){return t(this,e),s(this,e,arguments)}return l(e,React.Component),r(e,[{key:"render",value:function(){var t=!this.props.enabled;return wp.element.createElement("input",{type:"button",className:"button button-secondary button-danger ppma_maintenance_button",onClick:this.props.onClick,disabled:t,value:this.props.label})}}])}(),m=function(){function e(){return t(this,e),s(this,e,arguments)}return l(e,React.Component),r(e,[{key:"render",value:function(){return wp.element.createElement("div",null,wp.element.createElement("div",{className:"ppma_maintenance_log",readOnly:!0},this.props.log))}}])}(),g=function(){function e(){return t(this,e),s(this,e,arguments)}return l(e,React.Component),r(e,[{key:"render",value:function(){var t=wp.element.createElement("div",{className:"p-progressbar-label"},this.props.value," %");return wp.element.createElement("div",{role:"progressbar",className:"p-progressbar p-component p-progressbar-determinate","aria-valuemin":"0","aria-valuenow":this.props.value,"aria-valuemax":"100"},wp.element.createElement("div",{className:"p-progressbar-value p-progressbar-value-animate",style:{width:this.props.value+"%",display:"block"}}),t)}}])}();jQuery(function(){ReactDOM.render(wp.element.createElement(c,{nonce:ppmaMolonguiAuthorshipMigration.nonce}),document.getElementById("publishpress-authors-molongui-authorship-migration"))})})();